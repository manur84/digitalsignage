<Window x:Class="DigitalSignage.Server.Views.Dialogs.ClientInstallerDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:converters="clr-namespace:DigitalSignage.Server.Converters"
        mc:Ignorable="d"
        Title="Client Installer"
        Width="1000"
        Height="650"
        WindowStartupLocation="CenterOwner"
        Background="#F5F5F5">
    <Window.Resources>
        <converters:InverseBooleanConverter x:Key="InverseBooleanConverter"/>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
    </Window.Resources>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,16">
            <TextBlock Text="Client im Netzwerk installieren" FontSize="24" FontWeight="Bold" Margin="0,0,0,6"/>
            <TextBlock Text="Scanne nach Geraeten, waehle ein Ziel und fuehre install.sh remote aus."
                       Foreground="#666666" />
        </StackPanel>

        <!-- Content -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="3*"/>
                <ColumnDefinition Width="2*"/>
            </Grid.ColumnDefinitions>

            <!-- Discovered devices list -->
            <Border Grid.Column="0" Background="White" BorderBrush="#DDDDDD" BorderThickness="1" CornerRadius="6" Padding="12" Margin="0,0,8,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,12">
                        <TextBlock Text="Gefundene Geraete" Margin="0,0,16,0"/>
                        <Button Content="Scan starten" Padding="12,6" Margin="0,0,8,0"
                                Command="{Binding DiscoveredDevices.ScanNetworkCommand}"
                                IsEnabled="{Binding DiscoveredDevices.IsScanning, Converter={StaticResource InverseBooleanConverter}}"/>
                        <Button Content="Liste aktualisieren" Padding="12,6" Margin="0,0,8,0"
                                Command="{Binding DiscoveredDevices.RefreshListCommand}"
                                IsEnabled="{Binding DiscoveredDevices.IsScanning, Converter={StaticResource InverseBooleanConverter}}"/>
                        <Button Content="Alle löschen" Padding="12,6"
                                Command="{Binding DiscoveredDevices.ClearDiscoveredDevicesCommand}"
                                IsEnabled="{Binding DiscoveredDevices.IsScanning, Converter={StaticResource InverseBooleanConverter}}"/>
                        <CheckBox Content="Tiefer Scan (Ping+Port+UDP)" Margin="16,0,0,0" VerticalAlignment="Center"
                                  IsChecked="{Binding DiscoveredDevices.UseDeepScan}"
                                  ToolTip="Aktiviert TCP-Port-Probe und UDP-Broadcast, falls Pings geblockt werden."/>
                    </StackPanel>

                    <DataGrid Grid.Row="1"
                              ItemsSource="{Binding DiscoveredDevices.DiscoveredDevices}"
                              SelectedItem="{Binding DiscoveredDevices.SelectedDiscoveredDevice}"
                              AutoGenerateColumns="False"
                              CanUserAddRows="False"
                              IsReadOnly="True"
                              SelectionMode="Single"
                              Margin="0,0,0,12">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Hostname" Binding="{Binding Hostname}" Width="150"/>
                            <DataGridTextColumn Header="IP" Binding="{Binding IpAddress}" Width="120"/>
                            <DataGridTextColumn Header="MAC" Binding="{Binding MacAddress}" Width="140"/>
                            <DataGridTextColumn Header="Methode" Binding="{Binding DiscoveryMethod}" Width="100"/>
                            <DataGridTextColumn Header="Entdeckt" Binding="{Binding DiscoveredAt, StringFormat='{}{0:dd.MM.yyyy HH:mm:ss}'}" Width="160"/>
                            <DataGridCheckBoxColumn Header="Raspberry Pi" Binding="{Binding IsLikelyRaspberryPi}" Width="100" IsReadOnly="True"/>
                        </DataGrid.Columns>
                    </DataGrid>

                    <Grid Grid.Row="2">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="0"
                                   Text="{Binding DiscoveredDevices.ScanStatusMessage}"
                                   Foreground="#666666"/>

                        <StackPanel Grid.Column="1" Orientation="Horizontal">
                            <ProgressBar Width="120" Height="16" Margin="0,0,8,0"
                                         IsIndeterminate="True"
                                         Visibility="{Binding DiscoveredDevices.IsScanning, Converter={StaticResource BoolToVisibilityConverter}}"/>
                            <TextBlock Text="Scanning..."
                                       Visibility="{Binding DiscoveredDevices.IsScanning, Converter={StaticResource BoolToVisibilityConverter}}"
                                       Foreground="#2196F3" FontWeight="SemiBold"/>
                        </StackPanel>
                    </Grid>
                </Grid>
            </Border>

            <!-- Installer settings -->
            <Border Grid.Column="1" Background="White" BorderBrush="#DDDDDD" BorderThickness="1" CornerRadius="6" Padding="12" Margin="8,0,0,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0" Text="SSH Einstellungen" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,12"/>

                    <Grid Grid.Row="1" Margin="0,0,0,12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="0" Text="Manuelle IP" VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <TextBox Grid.Column="1" Text="{Binding ManualTargetIp, UpdateSourceTrigger=PropertyChanged}" Padding="8"
                                 ToolTip="Optional: IP-Adresse eingeben, falls kein Geraet in der Liste ausgewaehlt ist."/>
                    </Grid>

                    <Grid Grid.Row="2">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Grid.Column="0" Text="Benutzer" VerticalAlignment="Center" Margin="0,0,8,8"/>
                        <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding SshUsername, UpdateSourceTrigger=PropertyChanged}" Padding="8" Margin="0,0,0,8"/>

                        <TextBlock Grid.Row="1" Grid.Column="0" Text="Passwort" VerticalAlignment="Center" Margin="0,0,8,8"/>
                        <PasswordBox Grid.Row="1" Grid.Column="1" Padding="8" PasswordChanged="OnPasswordChanged" Margin="0,0,0,8"/>

                        <TextBlock Grid.Row="2" Grid.Column="0" Text="Port" VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding SshPort, UpdateSourceTrigger=PropertyChanged}" Padding="8" />
                    </Grid>

                    <StackPanel Grid.Row="3" Margin="0,16,0,12" Orientation="Horizontal">
                        <TextBlock Text="Status:" FontWeight="SemiBold" Margin="0,0,4,0"/>
                        <TextBlock Text="{Binding StatusMessage}" Foreground="#444444" Margin="4,0,0,0"/>
                    </StackPanel>

                    <StackPanel Grid.Row="4">
                        <TextBlock Text="Protokoll" FontWeight="SemiBold" Margin="0,0,0,6"/>
                        <TextBox Text="{Binding LogOutput}" Height="240" AcceptsReturn="True" IsReadOnly="True"
                                 VerticalScrollBarVisibility="Auto" TextWrapping="Wrap"
                                 FontFamily="Consolas" Padding="8"/>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>

        <!-- Footer -->
        <Grid Grid.Row="2" Margin="0,16,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <TextBlock Grid.Column="0" VerticalAlignment="Center" Foreground="#666666">
                <Run Text="Ausgewaehltes Geraet: "/>
                <Run Text="{Binding DiscoveredDevices.SelectedDiscoveredDevice.Hostname}"/>
                <Run Text=" ("/>
                <Run Text="{Binding DiscoveredDevices.SelectedDiscoveredDevice.IpAddress}"/>
                <Run Text=")"/>
            </TextBlock>

            <Button Grid.Column="1" Content="Install.sh ausfuehren" Padding="20,8" Margin="0,0,8,0"
                    Command="{Binding InstallSelectedDeviceCommand}"
                    Style="{StaticResource PrimaryButton}"
                    IsEnabled="{Binding IsInstalling, Converter={StaticResource InverseBooleanConverter}}"/>

            <Button Grid.Column="2" Content="Schließen" Padding="20,8" IsCancel="True"/>
        </Grid>
    </Grid>
</Window>



