<UserControl x:Class="DigitalSignage.Server.Views.ModernDesignerView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
             xmlns:controls="clr-namespace:DigitalSignage.Server.Controls"
             xmlns:converters="clr-namespace:DigitalSignage.Server.Converters"
             xmlns:behaviors="clr-namespace:DigitalSignage.Server.Behaviors"
             mc:Ignorable="d"
             d:DesignHeight="800" d:DesignWidth="1400">

    <UserControl.Resources>
        <!-- Modern Color Scheme -->
        <SolidColorBrush x:Key="PrimaryBrush" Color="#0078D4"/>
        <SolidColorBrush x:Key="SecondaryBrush" Color="#F3F3F3"/>
        <SolidColorBrush x:Key="AccentBrush" Color="#005A9E"/>
        <SolidColorBrush x:Key="DarkBackgroundBrush" Color="#2B2B2B"/>
        <SolidColorBrush x:Key="LightBackgroundBrush" Color="#FAFAFA"/>

        <!-- Converters -->
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <converters:NullToVisibilityConverter x:Key="NullToVisibilityConverter"/>

        <!-- Modern Button Style -->
        <Style x:Key="ModernToolButton" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="Margin" Value="2"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="4">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#E1E1E1"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#C1C1C1"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Tool Icon Button Style -->
        <Style x:Key="ToolIconButton" TargetType="Button" BasedOn="{StaticResource ModernToolButton}">
            <Setter Property="Width" Value="48"/>
            <Setter Property="Height" Value="48"/>
            <Setter Property="Padding" Value="4"/>
        </Style>

        <!-- Panel Header Style -->
        <Style x:Key="PanelHeaderStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="#333333"/>
            <Setter Property="Margin" Value="12,8"/>
        </Style>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <!-- Ribbon Toolbar -->
            <RowDefinition Height="*"/>    <!-- Main Content -->
            <RowDefinition Height="Auto"/> <!-- Status Bar -->
        </Grid.RowDefinitions>

        <!-- Modern Ribbon-Style Toolbar -->
        <Border Grid.Row="0" Background="{StaticResource SecondaryBrush}"
                BorderBrush="#E0E0E0" BorderThickness="0,0,0,1">
            <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Disabled">
                <StackPanel Orientation="Horizontal">
                    <!-- File Group -->
                    <Border BorderBrush="#D0D0D0" BorderThickness="0,0,1,0" Padding="8,4">
                        <StackPanel>
                            <TextBlock Text="FILE" FontSize="10" Foreground="#666666" FontWeight="SemiBold" Margin="4,2"/>
                            <StackPanel Orientation="Horizontal">
                                <Button Style="{StaticResource ModernToolButton}"
                                        Command="{Binding CreateNewLayoutCommand}"
                                        ToolTip="New Layout">
                                    <StackPanel>
                                        <TextBlock Text="ðŸ“„" FontSize="20" HorizontalAlignment="Center"/>
                                        <TextBlock Text="New" FontSize="10" Margin="0,2,0,0"/>
                                    </StackPanel>
                                </Button>
                                <Button Style="{StaticResource ModernToolButton}"
                                        Command="{Binding SaveLayoutCommand}"
                                        ToolTip="Save Layout">
                                    <StackPanel>
                                        <TextBlock Text="ðŸ’¾" FontSize="20" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Save" FontSize="10" Margin="0,2,0,0"/>
                                    </StackPanel>
                                </Button>
                                <Button Style="{StaticResource ModernToolButton}"
                                        Command="{Binding OpenLayoutCommand}"
                                        ToolTip="Open Layout">
                                    <StackPanel>
                                        <TextBlock Text="ðŸ“" FontSize="20" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Open" FontSize="10" Margin="0,2,0,0"/>
                                    </StackPanel>
                                </Button>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- Edit Group -->
                    <Border BorderBrush="#D0D0D0" BorderThickness="0,0,1,0" Padding="8,4">
                        <StackPanel>
                            <TextBlock Text="EDIT" FontSize="10" Foreground="#666666" FontWeight="SemiBold" Margin="4,2"/>
                            <StackPanel Orientation="Horizontal">
                                <Button Style="{StaticResource ModernToolButton}"
                                        Command="{Binding UndoCommand}"
                                        ToolTip="Undo (Ctrl+Z)">
                                    <StackPanel>
                                        <TextBlock Text="â†¶" FontSize="20" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Undo" FontSize="10" Margin="0,2,0,0"/>
                                    </StackPanel>
                                </Button>
                                <Button Style="{StaticResource ModernToolButton}"
                                        Command="{Binding RedoCommand}"
                                        ToolTip="Redo (Ctrl+Y)">
                                    <StackPanel>
                                        <TextBlock Text="â†·" FontSize="20" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Redo" FontSize="10" Margin="0,2,0,0"/>
                                    </StackPanel>
                                </Button>
                                <Rectangle Width="1" Fill="#D0D0D0" Margin="4,8"/>
                                <Button Style="{StaticResource ModernToolButton}"
                                        Command="{Binding CutCommand}"
                                        ToolTip="Cut (Ctrl+X)">
                                    <StackPanel>
                                        <TextBlock Text="âœ‚" FontSize="20" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Cut" FontSize="10" Margin="0,2,0,0"/>
                                    </StackPanel>
                                </Button>
                                <Button Style="{StaticResource ModernToolButton}"
                                        Command="{Binding CopyCommand}"
                                        ToolTip="Copy (Ctrl+C)">
                                    <StackPanel>
                                        <TextBlock Text="ðŸ“‹" FontSize="20" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Copy" FontSize="10" Margin="0,2,0,0"/>
                                    </StackPanel>
                                </Button>
                                <Button Style="{StaticResource ModernToolButton}"
                                        Command="{Binding PasteCommand}"
                                        ToolTip="Paste (Ctrl+V)">
                                    <StackPanel>
                                        <TextBlock Text="ðŸ“Œ" FontSize="20" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Paste" FontSize="10" Margin="0,2,0,0"/>
                                    </StackPanel>
                                </Button>
                                <Button Style="{StaticResource ModernToolButton}"
                                        Command="{Binding DeleteSelectedElementCommand}"
                                        ToolTip="Delete (Del)">
                                    <StackPanel>
                                        <TextBlock Text="ðŸ—‘" FontSize="20" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Delete" FontSize="10" Margin="0,2,0,0"/>
                                    </StackPanel>
                                </Button>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- Insert Group -->
                    <Border BorderBrush="#D0D0D0" BorderThickness="0,0,1,0" Padding="8,4">
                        <StackPanel>
                            <TextBlock Text="INSERT" FontSize="10" Foreground="#666666" FontWeight="SemiBold" Margin="4,2"/>
                            <StackPanel Orientation="Horizontal">
                                <Button Style="{StaticResource ModernToolButton}"
                                        Command="{Binding AddTextElementCommand}"
                                        ToolTip="Add Text">
                                    <StackPanel>
                                        <TextBlock Text="T" FontSize="20" FontWeight="Bold" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Text" FontSize="10" Margin="0,2,0,0"/>
                                    </StackPanel>
                                </Button>
                                <Button Style="{StaticResource ModernToolButton}"
                                        Command="{Binding AddMediaLibraryElementCommand}"
                                        ToolTip="Add Image">
                                    <StackPanel>
                                        <TextBlock Text="ðŸ–¼" FontSize="20" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Image" FontSize="10" Margin="0,2,0,0"/>
                                    </StackPanel>
                                </Button>
                                <Button Style="{StaticResource ModernToolButton}"
                                        Command="{Binding AddRectangleElementCommand}"
                                        ToolTip="Add Rectangle">
                                    <StackPanel>
                                        <Rectangle Width="20" Height="20" Stroke="#333333" StrokeThickness="2"/>
                                        <TextBlock Text="Shape" FontSize="10" Margin="0,2,0,0"/>
                                    </StackPanel>
                                </Button>
                                <Button Style="{StaticResource ModernToolButton}"
                                        Command="{Binding AddCircleElementCommand}"
                                        ToolTip="Add Circle">
                                    <StackPanel>
                                        <Ellipse Width="20" Height="20" Stroke="#333333" StrokeThickness="2"/>
                                        <TextBlock Text="Circle" FontSize="10" Margin="0,2,0,0"/>
                                    </StackPanel>
                                </Button>
                                <Button Style="{StaticResource ModernToolButton}"
                                        Command="{Binding AddQRCodeElementCommand}"
                                        ToolTip="Add QR Code">
                                    <StackPanel>
                                        <TextBlock Text="â–¦" FontSize="20" HorizontalAlignment="Center"/>
                                        <TextBlock Text="QR Code" FontSize="10" Margin="0,2,0,0"/>
                                    </StackPanel>
                                </Button>
                                <Button Style="{StaticResource ModernToolButton}"
                                        Command="{Binding AddTableElementCommand}"
                                        ToolTip="Add Table">
                                    <StackPanel>
                                        <TextBlock Text="â–¦" FontSize="20" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Table" FontSize="10" Margin="0,2,0,0"/>
                                    </StackPanel>
                                </Button>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- Arrange Group -->
                    <Border BorderBrush="#D0D0D0" BorderThickness="0,0,1,0" Padding="8,4">
                        <StackPanel>
                            <TextBlock Text="ARRANGE" FontSize="10" Foreground="#666666" FontWeight="SemiBold" Margin="4,2"/>
                            <StackPanel Orientation="Horizontal">
                                <Button Style="{StaticResource ModernToolButton}"
                                        Command="{Binding AlignLeftCommand}"
                                        ToolTip="Align Left">
                                    <StackPanel>
                                        <TextBlock Text="â¬…" FontSize="20" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Left" FontSize="10" Margin="0,2,0,0"/>
                                    </StackPanel>
                                </Button>
                                <Button Style="{StaticResource ModernToolButton}"
                                        Command="{Binding CenterHorizontalCommand}"
                                        ToolTip="Center Horizontal">
                                    <StackPanel>
                                        <TextBlock Text="â¬Œ" FontSize="20" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Center" FontSize="10" Margin="0,2,0,0"/>
                                    </StackPanel>
                                </Button>
                                <Button Style="{StaticResource ModernToolButton}"
                                        Command="{Binding AlignRightCommand}"
                                        ToolTip="Align Right">
                                    <StackPanel>
                                        <TextBlock Text="âž¡" FontSize="20" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Right" FontSize="10" Margin="0,2,0,0"/>
                                    </StackPanel>
                                </Button>
                                <Rectangle Width="1" Fill="#D0D0D0" Margin="4,8"/>
                                <Button Style="{StaticResource ModernToolButton}"
                                        Command="{Binding AlignTopCommand}"
                                        ToolTip="Align Top">
                                    <StackPanel>
                                        <TextBlock Text="â¬†" FontSize="20" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Top" FontSize="10" Margin="0,2,0,0"/>
                                    </StackPanel>
                                </Button>
                                <Button Style="{StaticResource ModernToolButton}"
                                        Command="{Binding CenterVerticalCommand}"
                                        ToolTip="Center Vertical">
                                    <StackPanel>
                                        <TextBlock Text="â¬" FontSize="20" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Middle" FontSize="10" Margin="0,2,0,0"/>
                                    </StackPanel>
                                </Button>
                                <Button Style="{StaticResource ModernToolButton}"
                                        Command="{Binding AlignBottomCommand}"
                                        ToolTip="Align Bottom">
                                    <StackPanel>
                                        <TextBlock Text="â¬‡" FontSize="20" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Bottom" FontSize="10" Margin="0,2,0,0"/>
                                    </StackPanel>
                                </Button>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- View Group -->
                    <Border Padding="8,4">
                        <StackPanel>
                            <TextBlock Text="VIEW" FontSize="10" Foreground="#666666" FontWeight="SemiBold" Margin="4,2"/>
                            <StackPanel Orientation="Horizontal">
                                <Button Style="{StaticResource ModernToolButton}"
                                        Command="{Binding ZoomInCommand}"
                                        ToolTip="Zoom In (Ctrl++)">
                                    <StackPanel>
                                        <TextBlock Text="ðŸ”+" FontSize="18" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Zoom In" FontSize="10" Margin="0,2,0,0"/>
                                    </StackPanel>
                                </Button>
                                <Button Style="{StaticResource ModernToolButton}"
                                        Command="{Binding ZoomOutCommand}"
                                        ToolTip="Zoom Out (Ctrl+-)">
                                    <StackPanel>
                                        <TextBlock Text="ðŸ”-" FontSize="18" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Zoom Out" FontSize="10" Margin="0,2,0,0"/>
                                    </StackPanel>
                                </Button>
                                <Button Style="{StaticResource ModernToolButton}"
                                        Command="{Binding ZoomToFitCommand}"
                                        ToolTip="Zoom to Fit (Ctrl+0)">
                                    <StackPanel>
                                        <TextBlock Text="â¬š" FontSize="20" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Fit" FontSize="10" Margin="0,2,0,0"/>
                                    </StackPanel>
                                </Button>
                                <Rectangle Width="1" Fill="#D0D0D0" Margin="4,8"/>
                                <ToggleButton IsChecked="{Binding ShowGrid}"
                                              Style="{StaticResource {x:Type ToggleButton}}"
                                              Padding="12,8" Margin="2"
                                              ToolTip="Show Grid">
                                    <StackPanel>
                                        <TextBlock Text="âŠž" FontSize="20" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Grid" FontSize="10" Margin="0,2,0,0"/>
                                    </StackPanel>
                                </ToggleButton>
                                <ToggleButton IsChecked="{Binding SnapToGrid}"
                                              Style="{StaticResource {x:Type ToggleButton}}"
                                              Padding="12,8" Margin="2"
                                              ToolTip="Snap to Grid">
                                    <StackPanel>
                                        <TextBlock Text="âŠŸ" FontSize="20" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Snap" FontSize="10" Margin="0,2,0,0"/>
                                    </StackPanel>
                                </ToggleButton>
                                <ToggleButton IsChecked="{Binding ShowRulers}"
                                              Style="{StaticResource {x:Type ToggleButton}}"
                                              Padding="12,8" Margin="2"
                                              ToolTip="Show Rulers">
                                    <StackPanel>
                                        <TextBlock Text="ðŸ“" FontSize="20" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Rulers" FontSize="10" Margin="0,2,0,0"/>
                                    </StackPanel>
                                </ToggleButton>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </ScrollViewer>
        </Border>

        <!-- Main Content Area -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" MinWidth="60"/>  <!-- Toolbox -->
                <ColumnDefinition Width="3"/>                    <!-- Splitter -->
                <ColumnDefinition Width="250" MinWidth="200"/>   <!-- Layers Panel -->
                <ColumnDefinition Width="3"/>                    <!-- Splitter -->
                <ColumnDefinition Width="*"/>                    <!-- Canvas -->
                <ColumnDefinition Width="3"/>                    <!-- Splitter -->
                <ColumnDefinition Width="300" MinWidth="250"/>   <!-- Properties Panel -->
            </Grid.ColumnDefinitions>

            <!-- Toolbox Panel -->
            <Border Grid.Column="0" Background="{StaticResource LightBackgroundBrush}"
                    BorderBrush="#E0E0E0" BorderThickness="0,0,1,0">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="8">
                        <Button Style="{StaticResource ToolIconButton}"
                                Command="{Binding SelectToolCommand}"
                                CommandParameter="select"
                                ToolTip="Select Tool (V)">
                            <TextBlock Text="â¬š" FontSize="24"/>
                        </Button>

                        <Separator Margin="4,8" Background="#E0E0E0"/>

                        <Button Style="{StaticResource ToolIconButton}"
                                behaviors:ToolboxDragBehavior.IsDragEnabled="True"
                                behaviors:ToolboxDragBehavior.ElementType="text"
                                Command="{Binding AddTextElementCommand}"
                                ToolTip="Text Tool (T) - Click to add or drag to position">
                            <TextBlock Text="T" FontSize="24" FontWeight="Bold"/>
                        </Button>

                        <Button Style="{StaticResource ToolIconButton}"
                                behaviors:ToolboxDragBehavior.IsDragEnabled="True"
                                behaviors:ToolboxDragBehavior.ElementType="media"
                                Command="{Binding AddMediaLibraryElementCommand}"
                                ToolTip="Image Tool (I) - Click to add or drag to position">
                            <TextBlock Text="ðŸ–¼" FontSize="22"/>
                        </Button>

                        <Button Style="{StaticResource ToolIconButton}"
                                behaviors:ToolboxDragBehavior.IsDragEnabled="True"
                                behaviors:ToolboxDragBehavior.ElementType="rectangle"
                                Command="{Binding AddRectangleElementCommand}"
                                ToolTip="Rectangle Tool (R) - Click to add or drag to position">
                            <Rectangle Width="28" Height="20" Stroke="#333333" StrokeThickness="2"/>
                        </Button>

                        <Button Style="{StaticResource ToolIconButton}"
                                behaviors:ToolboxDragBehavior.IsDragEnabled="True"
                                behaviors:ToolboxDragBehavior.ElementType="circle"
                                Command="{Binding AddCircleElementCommand}"
                                ToolTip="Circle Tool (C) - Click to add or drag to position">
                            <Ellipse Width="28" Height="28" Stroke="#333333" StrokeThickness="2"/>
                        </Button>

                        <Button Style="{StaticResource ToolIconButton}"
                                behaviors:ToolboxDragBehavior.IsDragEnabled="True"
                                behaviors:ToolboxDragBehavior.ElementType="qrcode"
                                Command="{Binding AddQRCodeElementCommand}"
                                ToolTip="QR Code Tool - Click to add or drag to position">
                            <TextBlock Text="â–¦" FontSize="24"/>
                        </Button>

                        <Button Style="{StaticResource ToolIconButton}"
                                behaviors:ToolboxDragBehavior.IsDragEnabled="True"
                                behaviors:ToolboxDragBehavior.ElementType="table"
                                Command="{Binding AddTableElementCommand}"
                                ToolTip="Table Tool - Click to add or drag to position">
                            <TextBlock Text="âŠž" FontSize="24"/>
                        </Button>
                    </StackPanel>
                </ScrollViewer>
            </Border>

            <!-- Splitter -->
            <GridSplitter Grid.Column="1" Width="3" HorizontalAlignment="Stretch"
                          Background="#E0E0E0" ResizeBehavior="PreviousAndNext"/>

            <!-- Layers Panel -->
            <Border Grid.Column="2" Background="White">
                <DockPanel>
                    <Border DockPanel.Dock="Top" Background="{StaticResource SecondaryBrush}"
                            BorderBrush="#E0E0E0" BorderThickness="0,0,0,1">
                        <TextBlock Text="LAYERS" Style="{StaticResource PanelHeaderStyle}"/>
                    </Border>

                    <ListBox ItemsSource="{Binding Layers}"
                             SelectedItem="{Binding SelectedLayer}"
                             Background="White"
                             BorderThickness="0"
                             ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Border Padding="8,6" BorderBrush="#F0F0F0" BorderThickness="0,0,0,1">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- Visibility Toggle -->
                                        <CheckBox Grid.Column="0" IsChecked="{Binding Visible}"
                                                  Margin="0,0,8,0" VerticalAlignment="Center"/>

                                        <!-- Layer Name -->
                                        <TextBlock Grid.Column="1" Text="{Binding Name}"
                                                   VerticalAlignment="Center" TextTrimming="CharacterEllipsis"/>

                                        <!-- Lock Toggle -->
                                        <ToggleButton Grid.Column="2" Width="24" Height="24"
                                                      Margin="0,0,4,0" Background="Transparent"
                                                      BorderThickness="0" ToolTip="Lock/Unlock Layer">
                                            <TextBlock Text="ðŸ”’" FontSize="12"/>
                                        </ToggleButton>

                                        <!-- Options Menu -->
                                        <Button Grid.Column="3" Width="24" Height="24"
                                                Background="Transparent" BorderThickness="0">
                                            <TextBlock Text="â‹®" FontSize="16" FontWeight="Bold"/>
                                        </Button>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </DockPanel>
            </Border>

            <!-- Splitter -->
            <GridSplitter Grid.Column="3" Width="3" HorizontalAlignment="Stretch"
                          Background="#E0E0E0" ResizeBehavior="PreviousAndNext"/>

            <!-- Canvas Area -->
            <Border Grid.Column="4" Background="#E8E8E8">
                <Grid>
                    <!-- Canvas Container with Zoom -->
                    <ScrollViewer HorizontalScrollBarVisibility="Auto"
                                  VerticalScrollBarVisibility="Auto"
                                  Background="#E8E8E8">
                        <Border Margin="50" Background="White"
                                BorderBrush="#C0C0C0" BorderThickness="1"
                                RenderTransformOrigin="0.5,0.5">
                            <Border.Effect>
                                <DropShadowEffect Color="#888888" Direction="270"
                                                  ShadowDepth="5" Opacity="0.3" BlurRadius="10"/>
                            </Border.Effect>

                            <controls:ModernDesignerCanvas x:Name="DesignerCanvas"
                                                          Width="{Binding CurrentLayout.Resolution.Width}"
                                                          Height="{Binding CurrentLayout.Resolution.Height}"
                                                          ShowGrid="{Binding ShowGrid}"
                                                          SnapToGrid="{Binding SnapToGrid}"
                                                          GridSize="{Binding GridSize}"
                                                          ShowRulers="{Binding ShowRulers}"
                                                          ZoomLevel="{Binding ZoomLevel}"
                                                          Background="White">
                                <!-- Elements will be rendered here -->
                                <controls:DesignerItemsControl ItemsSource="{Binding Elements}"
                                                               Width="{Binding CurrentLayout.Resolution.Width}"
                                                               Height="{Binding CurrentLayout.Resolution.Height}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <Canvas Width="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                                    Height="{Binding ActualHeight, RelativeSource={RelativeSource AncestorType=ItemsControl}}"/>
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <controls:DesignerItemControl DisplayElement="{Binding}"
                                                                         IsSelected="{Binding IsSelected}"
                                                                         Width="{Binding Size.Width}"
                                                                         Height="{Binding Size.Height}"/>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </controls:DesignerItemsControl>
                            </controls:ModernDesignerCanvas>
                        </Border>
                    </ScrollViewer>

                    <!-- Zoom Controls Overlay -->
                    <Border HorizontalAlignment="Right" VerticalAlignment="Bottom"
                            Margin="20" Background="White" CornerRadius="4"
                            BorderBrush="#C0C0C0" BorderThickness="1">
                        <Border.Effect>
                            <DropShadowEffect Color="#888888" Direction="270"
                                              ShadowDepth="2" Opacity="0.2" BlurRadius="5"/>
                        </Border.Effect>
                        <StackPanel Orientation="Horizontal" Margin="8,4">
                            <Button Content="-" Width="24" Height="24"
                                    Command="{Binding ZoomOutCommand}"
                                    Background="Transparent" BorderThickness="0"/>
                            <TextBlock Text="{Binding ZoomLevel, StringFormat='{}{0:P0}'}"
                                       VerticalAlignment="Center" Margin="8,0" MinWidth="40"
                                       TextAlignment="Center"/>
                            <Button Content="+" Width="24" Height="24"
                                    Command="{Binding ZoomInCommand}"
                                    Background="Transparent" BorderThickness="0"/>
                            <Rectangle Width="1" Fill="#D0D0D0" Margin="4,2"/>
                            <Button Content="Fit" Padding="8,0"
                                    Command="{Binding ZoomToFitCommand}"
                                    Background="Transparent" BorderThickness="0"/>
                        </StackPanel>
                    </Border>
                </Grid>
            </Border>

            <!-- Splitter -->
            <GridSplitter Grid.Column="5" Width="3" HorizontalAlignment="Stretch"
                          Background="#E0E0E0" ResizeBehavior="PreviousAndNext"/>

            <!-- Properties Panel -->
            <Border Grid.Column="6" Background="White">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <DockPanel>
                        <Border DockPanel.Dock="Top" Background="{StaticResource SecondaryBrush}"
                                BorderBrush="#E0E0E0" BorderThickness="0,0,0,1">
                            <TextBlock Text="PROPERTIES" Style="{StaticResource PanelHeaderStyle}"/>
                        </Border>

                        <StackPanel Margin="12">
                            <!-- Layout Properties -->
                            <Expander Header="Layout" IsExpanded="True">
                                <StackPanel Margin="8,4">
                                    <TextBlock Text="Name" FontWeight="SemiBold" Margin="0,4,0,2"/>
                                    <TextBox Text="{Binding CurrentLayout.Name, UpdateSourceTrigger=PropertyChanged}"
                                             Padding="4" BorderThickness="1"/>

                                    <TextBlock Text="Resolution" FontWeight="SemiBold" Margin="0,8,0,2"/>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBox Grid.Column="0"
                                                 Text="{Binding CurrentLayout.Resolution.Width, UpdateSourceTrigger=PropertyChanged}"
                                                 Padding="4" BorderThickness="1"/>
                                        <TextBlock Grid.Column="1" Text=" Ã— " VerticalAlignment="Center" Margin="4,0"/>
                                        <TextBox Grid.Column="2"
                                                 Text="{Binding CurrentLayout.Resolution.Height, UpdateSourceTrigger=PropertyChanged}"
                                                 Padding="4" BorderThickness="1"/>
                                    </Grid>

                                    <TextBlock Text="Background" FontWeight="SemiBold" Margin="0,8,0,2"/>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBox Grid.Column="0"
                                                 Text="{Binding CurrentLayout.BackgroundColor, UpdateSourceTrigger=PropertyChanged}"
                                                 Padding="4" BorderThickness="1"/>
                                        <Button Grid.Column="1" Content="..." Width="30" Margin="4,0,0,0"
                                                ToolTip="Choose Color"/>
                                    </Grid>
                                </StackPanel>
                            </Expander>

                            <!-- Element Properties (when selected) -->
                            <Expander Header="Element" IsExpanded="True" Margin="0,8,0,0"
                                      Visibility="{Binding SelectedElement, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=Inverse}">
                                <StackPanel Margin="8,4">
                                    <TextBlock Text="Name" FontWeight="SemiBold" Margin="0,4,0,2"/>
                                    <TextBox Text="{Binding SelectedElement.Name, UpdateSourceTrigger=PropertyChanged}"
                                             Padding="4" BorderThickness="1"/>

                                    <TextBlock Text="Position" FontWeight="SemiBold" Margin="0,8,0,2"/>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Grid.Column="0" Text="X:" VerticalAlignment="Center" Margin="0,0,4,0"/>
                                        <TextBox Grid.Column="1"
                                                 Text="{Binding SelectedElement.Position.X, UpdateSourceTrigger=PropertyChanged}"
                                                 Padding="4" BorderThickness="1"/>
                                        <TextBlock Grid.Column="2" Text=" Y:" VerticalAlignment="Center" Margin="8,0,4,0"/>
                                        <TextBox Grid.Column="3"
                                                 Text="{Binding SelectedElement.Position.Y, UpdateSourceTrigger=PropertyChanged}"
                                                 Padding="4" BorderThickness="1"/>
                                    </Grid>

                                    <TextBlock Text="Size" FontWeight="SemiBold" Margin="0,8,0,2"/>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Grid.Column="0" Text="W:" VerticalAlignment="Center" Margin="0,0,4,0"/>
                                        <TextBox Grid.Column="1"
                                                 Text="{Binding SelectedElement.Size.Width, UpdateSourceTrigger=PropertyChanged}"
                                                 Padding="4" BorderThickness="1"/>
                                        <TextBlock Grid.Column="2" Text=" H:" VerticalAlignment="Center" Margin="8,0,4,0"/>
                                        <TextBox Grid.Column="3"
                                                 Text="{Binding SelectedElement.Size.Height, UpdateSourceTrigger=PropertyChanged}"
                                                 Padding="4" BorderThickness="1"/>
                                    </Grid>

                                    <TextBlock Text="Rotation" FontWeight="SemiBold" Margin="0,8,0,2"/>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="60"/>
                                        </Grid.ColumnDefinitions>
                                        <Slider Grid.Column="0" Minimum="0" Maximum="360"
                                                Value="{Binding SelectedElement[Rotation], FallbackValue=0}"
                                                TickFrequency="15" IsSnapToTickEnabled="True"/>
                                        <TextBox Grid.Column="1" Margin="4,0,0,0"
                                                 Text="{Binding SelectedElement[Rotation], FallbackValue=0, UpdateSourceTrigger=PropertyChanged}"
                                                 Padding="4" BorderThickness="1"/>
                                    </Grid>

                                    <TextBlock Text="Opacity" FontWeight="SemiBold" Margin="0,8,0,2"/>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="60"/>
                                        </Grid.ColumnDefinitions>
                                        <Slider Grid.Column="0" Minimum="0" Maximum="1"
                                                Value="{Binding SelectedElement.Opacity, FallbackValue=1}"
                                                TickFrequency="0.1"/>
                                        <TextBox Grid.Column="1" Margin="4,0,0,0"
                                                 Text="{Binding SelectedElement.Opacity, FallbackValue=1, StringFormat=F2, UpdateSourceTrigger=PropertyChanged}"
                                                 Padding="4" BorderThickness="1"/>
                                    </Grid>
                                </StackPanel>
                            </Expander>
                        </StackPanel>
                    </DockPanel>
                </ScrollViewer>
            </Border>
        </Grid>

        <!-- Status Bar -->
        <Border Grid.Row="2" Background="{StaticResource SecondaryBrush}"
                BorderBrush="#E0E0E0" BorderThickness="0,1,0,0">
            <Grid Margin="8,4">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0" Text="{Binding StatusMessage}"
                           VerticalAlignment="Center" Foreground="#666666"/>

                <TextBlock Grid.Column="1" VerticalAlignment="Center" Margin="0,0,16,0">
                    <Run Text="Elements:" Foreground="#666666"/>
                    <Run Text="{Binding Elements.Count}" FontWeight="SemiBold"/>
                </TextBlock>

                <TextBlock Grid.Column="2" VerticalAlignment="Center" Margin="0,0,16,0">
                    <Run Text="Selected:" Foreground="#666666"/>
                    <Run Text="{Binding SelectionService.SelectedElements.Count}" FontWeight="SemiBold"/>
                </TextBlock>

                <TextBlock Grid.Column="3" VerticalAlignment="Center">
                    <Run Text="Zoom:" Foreground="#666666"/>
                    <Run Text="{Binding ZoomLevel, StringFormat='{}{0:P0}'}" FontWeight="SemiBold"/>
                </TextBlock>
            </Grid>
        </Border>
    </Grid>
</UserControl>
