<UserControl x:Class="DigitalSignage.Server.Views.Designer.PropertiesPanelControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:DigitalSignage.Server.Views"
             xmlns:converters="clr-namespace:DigitalSignage.Server.Converters"
             mc:Ignorable="d"
             d:DesignHeight="800" d:DesignWidth="300">
    <UserControl.Resources>
        <converters:ElementTypeToVisibilityConverter x:Key="ElementTypeToVisibilityConverter"/>
    </UserControl.Resources>
    <Border Background="White" BorderBrush="#CCCCCC" BorderThickness="1,0,0,0">
        <ScrollViewer>
            <StackPanel Margin="12">
                <TextBlock Text="Properties" FontSize="18" FontWeight="Bold" Margin="0,0,0,12"/>

                <!-- Layout Properties -->
                <TextBlock Text="Layout" FontWeight="SemiBold" Margin="0,8,0,4"/>
                <TextBlock Text="Name:" Margin="0,4,0,2"/>
                <TextBox Text="{Binding CurrentLayout.Name, UpdateSourceTrigger=PropertyChanged}"/>

                <TextBlock Text="Resolution:" Margin="0,8,0,2"/>
                <StackPanel Orientation="Horizontal">
                    <TextBox Width="80" Text="{Binding CurrentLayout.Resolution.Width, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,4,0"/>
                    <TextBlock Text="×" Margin="4,0" VerticalAlignment="Center"/>
                    <TextBox Width="80" Text="{Binding CurrentLayout.Resolution.Height, UpdateSourceTrigger=PropertyChanged}" Margin="4,0,0,0"/>
                </StackPanel>

                <TextBlock Text="Background:" Margin="0,12,0,4"/>
                <TextBox Text="{Binding CurrentLayout.BackgroundColor, UpdateSourceTrigger=PropertyChanged}"/>

                <Separator Margin="0,16"/>

                <!-- Selected Element Properties -->
                <TextBlock Text="Selected Element" FontWeight="SemiBold" Margin="0,8,0,4"/>

                <!-- Show when no element is selected -->
                <TextBlock Text="No element selected"
                          Foreground="Gray"
                          Margin="0,8">
                    <TextBlock.Visibility>
                        <Binding Path="SelectedElement">
                            <Binding.Converter>
                                <converters:NullToVisibilityConverter/>
                            </Binding.Converter>
                        </Binding>
                    </TextBlock.Visibility>
                </TextBlock>

                <!-- Show when element is selected -->
                <StackPanel>
                    <StackPanel.Visibility>
                        <Binding Path="SelectedElement">
                            <Binding.Converter>
                                <converters:NullToVisibilityConverter Invert="True"/>
                            </Binding.Converter>
                        </Binding>
                    </StackPanel.Visibility>

                    <TextBlock Text="Name:" Margin="0,4,0,2"/>
                    <TextBox Text="{Binding SelectedElement.Name, UpdateSourceTrigger=PropertyChanged}"/>

                    <TextBlock Text="Position:" Margin="0,12,0,4"/>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Grid.Column="0" Text="X:" VerticalAlignment="Center" Margin="0,0,4,0"/>
                        <TextBox Grid.Column="1" Text="{Binding SelectedElement.Position.X, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,8,0"/>
                        <TextBlock Grid.Column="2" Text="Y:" VerticalAlignment="Center" Margin="0,0,4,0"/>
                        <TextBox Grid.Column="3" Text="{Binding SelectedElement.Position.Y, UpdateSourceTrigger=PropertyChanged}"/>
                    </Grid>

                    <TextBlock Text="Size:" Margin="0,12,0,4"/>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Grid.Column="0" Text="W:" VerticalAlignment="Center" Margin="0,0,4,0"/>
                        <TextBox Grid.Column="1" Text="{Binding SelectedElement.Size.Width, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,8,0"/>
                        <TextBlock Grid.Column="2" Text="H:" VerticalAlignment="Center" Margin="0,0,4,0"/>
                        <TextBox Grid.Column="3" Text="{Binding SelectedElement.Size.Height, UpdateSourceTrigger=PropertyChanged}"/>
                    </Grid>

                    <TextBlock Text="Z-Index:" Margin="0,12,0,4"/>
                    <StackPanel Orientation="Horizontal">
                        <TextBox Width="60" Text="{Binding SelectedElement.ZIndex, UpdateSourceTrigger=PropertyChanged}"/>
                        <Button Content="▲" Command="{Binding MoveElementUpCommand}" Margin="8,0,4,0" Padding="8,2"/>
                        <Button Content="▼" Command="{Binding MoveElementDownCommand}" Padding="8,2"/>
                    </StackPanel>

                    <TextBlock Text="Rotation:" Margin="0,12,0,4"/>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <Slider Grid.Column="0"
                                Minimum="0"
                                Maximum="360"
                                Value="{Binding SelectedElement.Properties[Rotation], FallbackValue=0, UpdateSourceTrigger=PropertyChanged}"
                                TickFrequency="45"
                                IsSnapToTickEnabled="False"
                                Margin="0,0,8,0"/>
                        <TextBox Grid.Column="1"
                                Width="60"
                                Text="{Binding SelectedElement.Properties[Rotation], FallbackValue=0, UpdateSourceTrigger=PropertyChanged}"/>
                    </Grid>

                    <TextBlock Text="Opacity:" Margin="0,12,0,4"/>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <Slider Grid.Column="0"
                                Minimum="0"
                                Maximum="1"
                                Value="{Binding SelectedElement.Opacity, FallbackValue=1, UpdateSourceTrigger=PropertyChanged}"
                                TickFrequency="0.1"
                                IsSnapToTickEnabled="False"
                                Margin="0,0,8,0"/>
                        <TextBox Grid.Column="1"
                                Width="60"
                                Text="{Binding SelectedElement.Opacity, FallbackValue=1, StringFormat=F2, UpdateSourceTrigger=PropertyChanged}"/>
                    </Grid>

                    <TextBlock Text="Visibility:" Margin="0,12,0,4"/>
                    <CheckBox Content="Visible" IsChecked="{Binding SelectedElement.Visible, FallbackValue=True}" Margin="0,4,0,0"/>

                    <Separator Margin="0,16"/>

                    <!-- Advanced Properties -->
                    <TextBlock Text="Advanced" FontWeight="SemiBold" Margin="0,8,0,8"/>

                    <TextBlock Text="Border Radius:" Margin="0,4,0,2"/>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <Slider Grid.Column="0"
                                Minimum="0"
                                Maximum="100"
                                Value="{Binding SelectedElement.Properties[BorderRadius], FallbackValue=0, UpdateSourceTrigger=PropertyChanged}"
                                TickFrequency="5"
                                IsSnapToTickEnabled="False"
                                Margin="0,0,8,0"/>
                        <TextBox Grid.Column="1"
                                Width="60"
                                Text="{Binding SelectedElement.Properties[BorderRadius], FallbackValue=0, UpdateSourceTrigger=PropertyChanged}"/>
                    </Grid>

                    <TextBlock Text="Shadow:" Margin="0,12,0,4"/>
                    <CheckBox Content="Enable Shadow" IsChecked="{Binding SelectedElement.Properties[EnableShadow], FallbackValue=False}" Margin="0,4,0,8"/>

                    <StackPanel Visibility="{Binding SelectedElement.Properties[EnableShadow], Converter={StaticResource BooleanToVisibilityConverter}, FallbackValue=Collapsed}">
                        <TextBlock Text="Shadow Blur:" Margin="0,4,0,2" FontSize="11"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Slider Grid.Column="0"
                                    Minimum="0"
                                    Maximum="50"
                                    Value="{Binding SelectedElement.Properties[ShadowBlur], FallbackValue=10, UpdateSourceTrigger=PropertyChanged}"
                                    TickFrequency="5"
                                    IsSnapToTickEnabled="False"
                                    Margin="0,0,8,0"/>
                            <TextBox Grid.Column="1"
                                    Width="60"
                                    Text="{Binding SelectedElement.Properties[ShadowBlur], FallbackValue=10, UpdateSourceTrigger=PropertyChanged}"/>
                        </Grid>

                        <TextBlock Text="Shadow Color:" Margin="0,8,0,2" FontSize="11"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBox Grid.Column="0"
                                    Text="{Binding SelectedElement.Properties[ShadowColor], FallbackValue=#80000000, UpdateSourceTrigger=PropertyChanged}"
                                    Margin="0,0,8,0"/>
                            <Border Grid.Column="1"
                                   Width="40"
                                   Height="30"
                                   BorderBrush="#CCCCCC"
                                   BorderThickness="1">
                                <Border.Background>
                                    <SolidColorBrush Color="{Binding SelectedElement.Properties[ShadowColor], Converter={StaticResource HexToColorConverter}, FallbackValue=#80000000}"/>
                                </Border.Background>
                            </Border>
                        </Grid>

                        <TextBlock Text="Shadow Offset X:" Margin="0,8,0,2" FontSize="11"/>
                        <TextBox Text="{Binding SelectedElement.Properties[ShadowOffsetX], FallbackValue=5, UpdateSourceTrigger=PropertyChanged}"/>

                        <TextBlock Text="Shadow Offset Y:" Margin="0,4,0,2" FontSize="11"/>
                        <TextBox Text="{Binding SelectedElement.Properties[ShadowOffsetY], FallbackValue=5, UpdateSourceTrigger=PropertyChanged}"/>
                    </StackPanel>

                    <Separator Margin="0,16"/>

                    <!-- Text Element Properties -->
                    <StackPanel>
                        <StackPanel.Style>
                            <Style TargetType="StackPanel">
                                <Setter Property="Visibility" Value="Collapsed"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding SelectedElement.Type}" Value="text">
                                        <Setter Property="Visibility" Value="Visible"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </StackPanel.Style>

                        <TextBlock Text="Text Properties" FontWeight="SemiBold" Margin="0,0,0,8"/>

                        <TextBlock Text="Content:" Margin="0,4,0,2"/>
                        <TextBox Text="{Binding SelectedElement.Properties[Content], UpdateSourceTrigger=PropertyChanged}"
                                Height="60"
                                TextWrapping="Wrap"
                                AcceptsReturn="True"
                                VerticalScrollBarVisibility="Auto"/>

                        <TextBlock Text="Font Family:" Margin="0,12,0,4"/>
                        <ComboBox SelectedValue="{Binding SelectedElement.Properties[FontFamily], FallbackValue=Arial, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                  SelectedValuePath="Content">
                            <ComboBoxItem Content="Arial"/>
                            <ComboBoxItem Content="Calibri"/>
                            <ComboBoxItem Content="Times New Roman"/>
                            <ComboBoxItem Content="Verdana"/>
                            <ComboBoxItem Content="Georgia"/>
                            <ComboBoxItem Content="Courier New"/>
                            <ComboBoxItem Content="Comic Sans MS"/>
                            <ComboBoxItem Content="Impact"/>
                            <ComboBoxItem Content="Tahoma"/>
                            <ComboBoxItem Content="Trebuchet MS"/>
                        </ComboBox>

                        <TextBlock Text="Font Size:" Margin="0,12,0,4"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Slider Grid.Column="0"
                                   Minimum="8"
                                   Maximum="144"
                                   Value="{Binding SelectedElement.Properties[FontSize], FallbackValue=24}"
                                   TickFrequency="4"
                                   IsSnapToTickEnabled="True"
                                   Margin="0,0,8,0"/>
                            <TextBox Grid.Column="1"
                                    Width="60"
                                    Text="{Binding SelectedElement.Properties[FontSize], FallbackValue=24, UpdateSourceTrigger=PropertyChanged}"/>
                        </Grid>

                        <TextBlock Text="Font Style:" Margin="0,12,0,4"/>
                        <StackPanel Orientation="Horizontal">
                            <ToggleButton Content="Bold"
                                         IsChecked="{Binding SelectedElement.Properties[FontWeight], Converter={StaticResource FontWeightToBoolConverter}, FallbackValue=False}"
                                         Width="60"
                                         Margin="0,0,4,0"
                                         Padding="8,4"/>
                            <ToggleButton Content="Italic"
                                         IsChecked="{Binding SelectedElement.Properties[FontStyle], Converter={StaticResource FontStyleToBoolConverter}, FallbackValue=False}"
                                         Width="60"
                                         Padding="8,4"/>
                        </StackPanel>

                        <TextBlock Text="Text Color:" Margin="0,12,0,4"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBox Grid.Column="0"
                                    Text="{Binding SelectedElement.Properties[Color], FallbackValue=#000000, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                    Margin="0,0,8,0"/>
                            <Border Grid.Column="1"
                                   Width="40"
                                   Height="30"
                                   BorderBrush="#CCCCCC"
                                   BorderThickness="1">
                                <Border.Background>
                                    <SolidColorBrush Color="{Binding SelectedElement.Properties[Color], Converter={StaticResource HexToColorConverter}, FallbackValue=Black}"/>
                                </Border.Background>
                            </Border>
                        </Grid>
                    </StackPanel>

                    <Separator Margin="0,16"/>

                    <!-- Rectangle/Shape Properties -->
                    <StackPanel Visibility="{Binding SelectedElement.Type, Converter={StaticResource ElementTypeToVisibilityConverter}, ConverterParameter='rectangle,shape,circle'}">
                        <TextBlock Text="Rectangle Properties" FontWeight="SemiBold" Margin="0,0,0,8"/>

                        <TextBlock Text="Fill Color:" Margin="0,4,0,2"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBox Grid.Column="0"
                                    Text="{Binding SelectedElement.Properties[FillColor], FallbackValue=#ADD8E6, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                    Margin="0,0,8,0"/>
                            <Border Grid.Column="1"
                                   Width="40"
                                   Height="30"
                                   BorderBrush="#CCCCCC"
                                   BorderThickness="1">
                                <Border.Background>
                                    <SolidColorBrush Color="{Binding SelectedElement.Properties[FillColor], Converter={StaticResource HexToColorConverter}, FallbackValue=LightBlue}"/>
                                </Border.Background>
                            </Border>
                        </Grid>

                        <TextBlock Text="Border Color:" Margin="0,12,0,4"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBox Grid.Column="0"
                                    Text="{Binding SelectedElement.Properties[BorderColor], FallbackValue=#00008B, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                    Margin="0,0,8,0"/>
                            <Border Grid.Column="1"
                                   Width="40"
                                   Height="30"
                                   BorderBrush="#CCCCCC"
                                   BorderThickness="1">
                                <Border.Background>
                                    <SolidColorBrush Color="{Binding SelectedElement.Properties[BorderColor], Converter={StaticResource HexToColorConverter}, FallbackValue=DarkBlue}"/>
                                </Border.Background>
                            </Border>
                        </Grid>

                        <TextBlock Text="Border Thickness:" Margin="0,12,0,4"/>
                        <TextBox Text="{Binding SelectedElement.Properties[BorderThickness], FallbackValue=2, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                    </StackPanel>

                    <Separator Margin="0,16"/>

                    <TextBlock Text="Actions:" FontWeight="SemiBold" Margin="0,8,0,8"/>
                    <Button Content="Duplicate Element" Command="{Binding DuplicateSelectedElementCommand}" Margin="0,0,0,4"/>
                    <Button Content="Delete Element" Command="{Binding DeleteSelectedElementCommand}" Style="{StaticResource SecondaryButton}"/>
                </StackPanel>
            </StackPanel>
        </ScrollViewer>
    </Border>
</UserControl>
