<UserControl x:Class="DigitalSignage.Server.Views.PropertiesPanel"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:DigitalSignage.Server.Converters"
             mc:Ignorable="d"
             d:DesignHeight="800" d:DesignWidth="300">

    <Border Background="White" BorderBrush="#CCCCCC" BorderThickness="1,0,0,0">
        <ScrollViewer>
            <StackPanel Margin="12">
                <TextBlock Text="Properties" FontSize="18" FontWeight="Bold" Margin="0,0,0,12"/>

                <!-- Layout Properties -->
                <TextBlock Text="Layout" FontWeight="SemiBold" Margin="0,8,0,4"/>
                <TextBlock Text="Name:" Margin="0,4,0,2"/>
                <TextBox Text="{Binding CurrentLayout.Name, UpdateSourceTrigger=PropertyChanged}"/>

                <TextBlock Text="Resolution:" Margin="0,8,0,2"/>
                <StackPanel Orientation="Horizontal">
                    <TextBox Width="80" Text="{Binding CurrentLayout.Resolution.Width, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,4,0"/>
                    <TextBlock Text="×" Margin="4,0" VerticalAlignment="Center"/>
                    <TextBox Width="80" Text="{Binding CurrentLayout.Resolution.Height, UpdateSourceTrigger=PropertyChanged}" Margin="4,0,0,0"/>
                </StackPanel>

                <TextBlock Text="Background:" Margin="0,12,0,4"/>
                <TextBox Text="{Binding CurrentLayout.BackgroundColor, UpdateSourceTrigger=PropertyChanged}"/>

                <Separator Margin="0,16"/>

                <!-- Selected Element Properties -->
                <TextBlock Text="Selected Element" FontWeight="SemiBold" Margin="0,8,0,4"/>

                <!-- Show when no element is selected -->
                <TextBlock Text="No element selected"
                          Foreground="Gray"
                          Margin="0,8">
                    <TextBlock.Visibility>
                        <Binding Path="SelectedElement">
                            <Binding.Converter>
                                <local:NullToVisibilityConverter/>
                            </Binding.Converter>
                        </Binding>
                    </TextBlock.Visibility>
                </TextBlock>

                <!-- Show when element is selected -->
                <StackPanel>
                    <StackPanel.Visibility>
                        <Binding Path="SelectedElement">
                            <Binding.Converter>
                                <local:NullToVisibilityConverter Invert="True"/>
                            </Binding.Converter>
                        </Binding>
                    </StackPanel.Visibility>

                    <TextBlock Text="Name:" Margin="0,4,0,2"/>
                    <TextBox Text="{Binding SelectedElement.Name, UpdateSourceTrigger=PropertyChanged}"/>

                    <TextBlock Text="Position:" Margin="0,12,0,4"/>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Grid.Column="0" Text="X:" VerticalAlignment="Center" Margin="0,0,4,0"/>
                        <TextBox Grid.Column="1" Text="{Binding SelectedElement.Position.X, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,8,0"/>
                        <TextBlock Grid.Column="2" Text="Y:" VerticalAlignment="Center" Margin="0,0,4,0"/>
                        <TextBox Grid.Column="3" Text="{Binding SelectedElement.Position.Y, UpdateSourceTrigger=PropertyChanged}"/>
                    </Grid>

                    <TextBlock Text="Size:" Margin="0,12,0,4"/>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Grid.Column="0" Text="W:" VerticalAlignment="Center" Margin="0,0,4,0"/>
                        <TextBox Grid.Column="1" Text="{Binding SelectedElement.Size.Width, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,8,0"/>
                        <TextBlock Grid.Column="2" Text="H:" VerticalAlignment="Center" Margin="0,0,4,0"/>
                        <TextBox Grid.Column="3" Text="{Binding SelectedElement.Size.Height, UpdateSourceTrigger=PropertyChanged}"/>
                    </Grid>

                    <TextBlock Text="Z-Index:" Margin="0,12,0,4"/>
                    <StackPanel Orientation="Horizontal">
                        <TextBox Width="60" Text="{Binding SelectedElement.ZIndex, UpdateSourceTrigger=PropertyChanged}"/>
                        <Button Content="▲" Command="{Binding MoveElementUpCommand}" Margin="8,0,4,0" Padding="8,2"/>
                        <Button Content="▼" Command="{Binding MoveElementDownCommand}" Padding="8,2"/>
                    </StackPanel>

                    <TextBlock Text="Opacity:" Margin="0,12,0,4"/>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <Slider Grid.Column="0"
                                Minimum="0"
                                Maximum="1"
                                Value="{Binding SelectedElement.Opacity, FallbackValue=1, UpdateSourceTrigger=PropertyChanged}"
                                TickFrequency="0.1"
                                IsSnapToTickEnabled="False"
                                Margin="0,0,8,0"/>
                        <TextBox Grid.Column="1"
                                Width="60"
                                Text="{Binding SelectedElement.Opacity, FallbackValue=1, StringFormat=F2, UpdateSourceTrigger=PropertyChanged}"/>
                    </Grid>

                    <TextBlock Text="Visibility:" Margin="0,12,0,4"/>
                    <CheckBox Content="Visible" IsChecked="{Binding SelectedElement.Visible, FallbackValue=True}" Margin="0,4,0,0"/>

                    <Separator Margin="0,16"/>

                    <!-- Advanced Properties -->
                    <TextBlock Text="Advanced" FontWeight="SemiBold" Margin="0,8,0,8"/>

                    <!-- Border Radius -->
                    <TextBlock Text="Border Radius:" Margin="0,4,0,2"/>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <Slider Grid.Column="0"
                                Minimum="0"
                                Maximum="50"
                                Value="{Binding SelectedElement[BorderRadius], FallbackValue=0, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"
                                TickFrequency="1"
                                IsSnapToTickEnabled="True"
                                Margin="0,0,8,0"/>
                        <TextBox Grid.Column="1"
                                Width="60"
                                Text="{Binding SelectedElement[BorderRadius], FallbackValue=0, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"/>
                    </Grid>

                    <!-- Shadow -->
                    <TextBlock Text="Shadow:" Margin="0,12,0,4"/>
                    <CheckBox Content="Enable Shadow"
                             IsChecked="{Binding SelectedElement[EnableShadow], FallbackValue=False, Mode=TwoWay}"
                             Margin="0,4,0,8"/>

                    <StackPanel Visibility="{Binding SelectedElement[EnableShadow], Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=Invert, FallbackValue=Collapsed}">
                        <TextBlock Text="Shadow Color:" Margin="0,4,0,2"/>
                        <TextBox Text="{Binding SelectedElement[ShadowColor], FallbackValue=#000000, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"/>

                        <TextBlock Text="Shadow Blur:" Margin="0,8,0,2"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Slider Grid.Column="0"
                                    Minimum="0"
                                    Maximum="50"
                                    Value="{Binding SelectedElement[ShadowBlur], FallbackValue=5, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"
                                    TickFrequency="1"
                                    IsSnapToTickEnabled="True"
                                    Margin="0,0,8,0"/>
                            <TextBox Grid.Column="1"
                                    Width="60"
                                    Text="{Binding SelectedElement[ShadowBlur], FallbackValue=5, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"/>
                        </Grid>

                        <TextBlock Text="Shadow Offset:" Margin="0,8,0,4"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0" Text="X:" VerticalAlignment="Center" Margin="0,0,4,0"/>
                            <TextBox Grid.Column="1" Text="{Binding SelectedElement[ShadowOffsetX], FallbackValue=2, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}" Margin="0,0,8,0"/>
                            <TextBlock Grid.Column="2" Text="Y:" VerticalAlignment="Center" Margin="0,0,4,0"/>
                            <TextBox Grid.Column="3" Text="{Binding SelectedElement[ShadowOffsetY], FallbackValue=2, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"/>
                        </Grid>
                    </StackPanel>

                    <Separator Margin="0,16"/>

                    <!-- Text Element Properties -->
                    <StackPanel>
                        <StackPanel.Style>
                            <Style TargetType="StackPanel">
                                <Setter Property="Visibility" Value="Collapsed"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding SelectedElement.Type}" Value="text">
                                        <Setter Property="Visibility" Value="Visible"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </StackPanel.Style>

                        <TextBlock Text="Text Properties" FontWeight="SemiBold" Margin="0,0,0,8"/>

                        <TextBlock Text="Content:" Margin="0,4,0,2"/>
                        <TextBox Text="{Binding SelectedElement[Content], UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"
                                Height="60"
                                TextWrapping="Wrap"
                                AcceptsReturn="True"
                                VerticalScrollBarVisibility="Auto"/>

                        <TextBlock Text="Font Size:" Margin="0,12,0,4"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Slider Grid.Column="0"
                                   Minimum="8"
                                   Maximum="144"
                                   Value="{Binding SelectedElement[FontSize], FallbackValue=24, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"
                                   TickFrequency="4"
                                   IsSnapToTickEnabled="True"
                                   Margin="0,0,8,0"/>
                            <TextBox Grid.Column="1"
                                    Width="60"
                                    Text="{Binding SelectedElement[FontSize], FallbackValue=24, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"/>
                        </Grid>

                        <TextBlock Text="Text Color:" Margin="0,12,0,4"/>
                        <TextBox Text="{Binding SelectedElement[Color], FallbackValue=#000000, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"/>

                        <!-- Advanced Text Properties -->
                        <TextBlock Text="Line Height:" Margin="0,12,0,4"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Slider Grid.Column="0"
                                   Minimum="0.5"
                                   Maximum="3"
                                   Value="{Binding SelectedElement[LineHeight], FallbackValue=1.2, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"
                                   TickFrequency="0.1"
                                   IsSnapToTickEnabled="False"
                                   Margin="0,0,8,0"/>
                            <TextBox Grid.Column="1"
                                    Width="60"
                                    Text="{Binding SelectedElement[LineHeight], FallbackValue=1.2, StringFormat=F2, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"/>
                        </Grid>

                        <TextBlock Text="Letter Spacing:" Margin="0,12,0,4"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Slider Grid.Column="0"
                                   Minimum="-5"
                                   Maximum="20"
                                   Value="{Binding SelectedElement[LetterSpacing], FallbackValue=0, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"
                                   TickFrequency="1"
                                   IsSnapToTickEnabled="True"
                                   Margin="0,0,8,0"/>
                            <TextBox Grid.Column="1"
                                    Width="60"
                                    Text="{Binding SelectedElement[LetterSpacing], FallbackValue=0, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"/>
                        </Grid>

                        <TextBlock Text="Text Decoration:" Margin="0,12,0,4"/>
                        <StackPanel Orientation="Horizontal">
                            <CheckBox Content="Underline" IsChecked="{Binding SelectedElement[TextDecoration_Underline], FallbackValue=False, Mode=TwoWay}" Margin="0,0,12,0"/>
                            <CheckBox Content="Strikethrough" IsChecked="{Binding SelectedElement[TextDecoration_Strikethrough], FallbackValue=False, Mode=TwoWay}"/>
                        </StackPanel>
                    </StackPanel>

                    <Separator Margin="0,16"/>

                    <!-- Rectangle/Shape Properties -->
                    <StackPanel Visibility="{Binding SelectedElement.Type, Converter={StaticResource ElementTypeToVisibilityConverter}, ConverterParameter='rectangle,shape,circle'}">
                        <TextBlock Text="Shape Properties" FontWeight="SemiBold" Margin="0,0,0,8"/>

                        <TextBlock Text="Fill Color:" Margin="0,4,0,2"/>
                        <TextBox Text="{Binding SelectedElement[FillColor], FallbackValue=#ADD8E6, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"/>

                        <TextBlock Text="Border Color:" Margin="0,12,0,4"/>
                        <TextBox Text="{Binding SelectedElement[BorderColor], FallbackValue=#00008B, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"/>

                        <TextBlock Text="Border Thickness:" Margin="0,12,0,4"/>
                        <TextBox Text="{Binding SelectedElement[BorderThickness], FallbackValue=2, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"/>
                    </StackPanel>

                    <Separator Margin="0,16"/>

                    <TextBlock Text="Actions:" FontWeight="SemiBold" Margin="0,8,0,8"/>
                    <Button Content="Duplicate Element" Command="{Binding DuplicateSelectedElementCommand}" Margin="0,0,0,4"/>
                    <Button Content="Delete Element" Command="{Binding DeleteSelectedElementCommand}" Style="{StaticResource SecondaryButton}"/>
                </StackPanel>
            </StackPanel>
        </ScrollViewer>
    </Border>
</UserControl>
