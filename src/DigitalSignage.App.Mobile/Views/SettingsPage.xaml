<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:DigitalSignage.App.Mobile.ViewModels"
             x:Class="DigitalSignage.App.Mobile.Views.SettingsPage"
             x:DataType="vm:SettingsViewModel"
             Title="{Binding Title}"
             BackgroundColor="{AppThemeBinding Light={StaticResource Background}, Dark={StaticResource DarkBackground}}">

    <ScrollView>
        <VerticalStackLayout Padding="16" Spacing="20">

            <!-- App Info Card -->
            <Frame BackgroundColor="{AppThemeBinding Light={StaticResource Surface}, Dark={StaticResource DarkSurface}}"
                   BorderColor="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource DarkGray700}}"
                   CornerRadius="12"
                   Padding="20"
                   HasShadow="False">
                <VerticalStackLayout Spacing="12">
                    <Image Source="digisign_logo.png"
                           HeightRequest="80"
                           HorizontalOptions="Center"/>
                    <Label Text="Digital Signage"
                           FontSize="22"
                           FontAttributes="Bold"
                           HorizontalOptions="Center"
                           TextColor="{AppThemeBinding Light={StaticResource Gray900}, Dark={StaticResource DarkGray900}}"/>
                    <Label Text="{Binding AppVersion, StringFormat='Version {0}'}"
                           FontSize="14"
                           HorizontalOptions="Center"
                           TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource DarkGray400}}"/>
                    <Button Text="About"
                            Command="{Binding ShowAboutCommand}"
                            BackgroundColor="Transparent"
                            TextColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource DarkPrimary}}"
                            FontSize="14"
                            HorizontalOptions="Center"
                            Margin="0,8,0,0"/>
                </VerticalStackLayout>
            </Frame>

            <!-- Connection Info -->
            <Frame BackgroundColor="{AppThemeBinding Light={StaticResource Surface}, Dark={StaticResource DarkSurface}}"
                   BorderColor="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource DarkGray700}}"
                   CornerRadius="12"
                   Padding="20"
                   HasShadow="False">
                <VerticalStackLayout Spacing="12">
                    <Label Text="Connection"
                           FontSize="18"
                           FontAttributes="Bold"
                           TextColor="{AppThemeBinding Light={StaticResource Gray900}, Dark={StaticResource DarkGray900}}"/>
                    
                    <Grid ColumnDefinitions="Auto,*" RowSpacing="8">
                        <Label Text="Server:"
                               FontSize="14"
                               TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource DarkGray400}}"
                               VerticalOptions="Center"/>
                        <Label Grid.Column="1"
                               Text="{Binding ServerUrl}"
                               FontSize="14"
                               TextColor="{AppThemeBinding Light={StaticResource Gray900}, Dark={StaticResource DarkGray900}}"
                               LineBreakMode="TailTruncation"
                               VerticalOptions="Center"
                               Margin="8,0,0,0"/>
                    </Grid>

                    <Button Text="Disconnect"
                            Command="{Binding DisconnectCommand}"
                            BackgroundColor="{AppThemeBinding Light={StaticResource Danger}, Dark={StaticResource DarkDanger}}"
                            TextColor="White"
                            FontSize="15"
                            HeightRequest="48"
                            CornerRadius="12"
                            Margin="0,8,0,0"/>
                </VerticalStackLayout>
            </Frame>

            <!-- Preferences -->
            <Frame BackgroundColor="{AppThemeBinding Light={StaticResource Surface}, Dark={StaticResource DarkSurface}}"
                   BorderColor="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource DarkGray700}}"
                   CornerRadius="12"
                   Padding="20"
                   HasShadow="False">
                <VerticalStackLayout Spacing="16">
                    <Label Text="Preferences"
                           FontSize="18"
                           FontAttributes="Bold"
                           TextColor="{AppThemeBinding Light={StaticResource Gray900}, Dark={StaticResource DarkGray900}}"/>

                    <!-- Dark Mode Toggle -->
                    <Grid ColumnDefinitions="*,Auto">
                        <VerticalStackLayout Grid.Column="0" Spacing="2">
                            <Label Text="Dark Mode"
                                   FontSize="15"
                                   FontAttributes="Bold"
                                   TextColor="{AppThemeBinding Light={StaticResource Gray900}, Dark={StaticResource DarkGray900}}"/>
                            <Label Text="Use dark theme throughout the app"
                                   FontSize="13"
                                   TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource DarkGray400}}"/>
                        </VerticalStackLayout>
                        <Switch Grid.Column="1"
                                IsToggled="{Binding IsDarkModeEnabled}"
                                Toggled="OnDarkModeToggled"
                                OnColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource DarkPrimary}}"
                                VerticalOptions="Center"
                                Margin="12,0,0,0"/>
                    </Grid>

                    <BoxView HeightRequest="1"
                             BackgroundColor="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource DarkGray700}}"/>

                    <!-- Biometric Auth Toggle -->
                    <Grid ColumnDefinitions="*,Auto">
                        <VerticalStackLayout Grid.Column="0" Spacing="2">
                            <Label Text="Biometric Authentication"
                                   FontSize="15"
                                   FontAttributes="Bold"
                                   TextColor="{AppThemeBinding Light={StaticResource Gray900}, Dark={StaticResource DarkGray900}}"/>
                            <Label Text="Use Face ID or Touch ID to unlock"
                                   FontSize="13"
                                   TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource DarkGray400}}"/>
                        </VerticalStackLayout>
                        <Switch Grid.Column="1"
                                IsToggled="{Binding IsBiometricAuthEnabled}"
                                Toggled="OnBiometricAuthToggled"
                                IsEnabled="{Binding IsBiometricAvailable}"
                                OnColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource DarkPrimary}}"
                                VerticalOptions="Center"
                                Margin="12,0,0,0"/>
                    </Grid>

                    <BoxView HeightRequest="1"
                             BackgroundColor="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource DarkGray700}}"/>

                    <!-- Push Notifications Toggle -->
                    <Grid ColumnDefinitions="*,Auto">
                        <VerticalStackLayout Grid.Column="0" Spacing="2">
                            <Label Text="Push Notifications"
                                   FontSize="15"
                                   FontAttributes="Bold"
                                   TextColor="{AppThemeBinding Light={StaticResource Gray900}, Dark={StaticResource DarkGray900}}"/>
                            <Label Text="Receive alerts for device events"
                                   FontSize="13"
                                   TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource DarkGray400}}"/>
                        </VerticalStackLayout>
                        <Switch Grid.Column="1"
                                IsToggled="{Binding IsPushNotificationsEnabled}"
                                Toggled="OnPushNotificationsToggled"
                                OnColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource DarkPrimary}}"
                                VerticalOptions="Center"
                                Margin="12,0,0,0"/>
                    </Grid>

                    <BoxView HeightRequest="1"
                             BackgroundColor="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource DarkGray700}}"/>

                    <!-- Auto Connect Toggle -->
                    <Grid ColumnDefinitions="*,Auto">
                        <VerticalStackLayout Grid.Column="0" Spacing="2">
                            <Label Text="Auto-Connect"
                                   FontSize="15"
                                   FontAttributes="Bold"
                                   TextColor="{AppThemeBinding Light={StaticResource Gray900}, Dark={StaticResource DarkGray900}}"/>
                            <Label Text="Automatically connect on app launch"
                                   FontSize="13"
                                   TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource DarkGray400}}"/>
                        </VerticalStackLayout>
                        <Switch Grid.Column="1"
                                IsToggled="{Binding IsAutoConnectEnabled}"
                                Toggled="OnAutoConnectToggled"
                                OnColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource DarkPrimary}}"
                                VerticalOptions="Center"
                                Margin="12,0,0,0"/>
                    </Grid>
                </VerticalStackLayout>
            </Frame>

            <!-- Data Management -->
            <Frame BackgroundColor="{AppThemeBinding Light={StaticResource Surface}, Dark={StaticResource DarkSurface}}"
                   BorderColor="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource DarkGray700}}"
                   CornerRadius="12"
                   Padding="20"
                   HasShadow="False">
                <VerticalStackLayout Spacing="16">
                    <Label Text="Data Management"
                           FontSize="18"
                           FontAttributes="Bold"
                           TextColor="{AppThemeBinding Light={StaticResource Gray900}, Dark={StaticResource DarkGray900}}"/>

                    <Button Text="Clear Cache"
                            Command="{Binding ClearCacheCommand}"
                            BackgroundColor="{AppThemeBinding Light={StaticResource Surface}, Dark={StaticResource DarkSurface}}"
                            TextColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource DarkPrimary}}"
                            BorderColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource DarkPrimary}}"
                            BorderWidth="2"
                            FontSize="15"
                            HeightRequest="48"
                            CornerRadius="12"/>

                    <Label Text="Clear offline data and cached images to free up storage space."
                           FontSize="13"
                           TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource DarkGray500}}"
                           Margin="0,-8,0,0"/>
                </VerticalStackLayout>
            </Frame>

            <!-- Loading Indicator -->
            <ActivityIndicator IsRunning="{Binding IsBusy}"
                              IsVisible="{Binding IsBusy}"
                              Color="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource DarkPrimary}}"
                              HeightRequest="40"/>

            <!-- Bottom Spacing -->
            <BoxView HeightRequest="20" Color="Transparent"/>

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>
